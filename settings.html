<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incorp — Settings</title>
    <meta name="description" content="Configure Incorp bot preferences for your Discord account.">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'><path d='m12 3-10 5 10 5 10-5-10-5z'/><path d='m2 12 10 5 10-5'/><path d='m2 17 10 5 10-5'/></svg>">
</head>

<body>

    <header class="site-header">
        <div class="site-header-container">
            <a href="index.html" class="logo">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m12 3-10 5 10 5 10-5-10-5z" />
                    <path d="m2 12 10 5 10-5" />
                    <path d="m2 17 10 5 10-5" />
                </svg>
                incorp
            </a>
            <div class="header-actions">
                <nav class="header-nav" aria-label="Social">
                    <a href="#" aria-label="GitHub"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M15 22v-4a4.8 4.8 0 0 0-1-3.2c3-.3 6-1.5 6-6.5a4.6 4.6 0 0 0-1.3-3.2 4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 5 3 6.2 6 6.5a4.8 4.8 0 0 0-1 3.2v4" />
                        </svg></a>
                    <a href="https://discord.com/users/1333972569014931466" aria-label="Discord" target="_blank"><svg
                            width="18" height="18" viewBox="0 0 127.14 96.36" fill="currentColor">
                            <path
                                d="M107.7 8.07A105.15 105.15 0 0 0 81.47 0a72.06 72.06 0 0 0-3.36 6.83 97.68 97.68 0 0 0-29.11 0A72.37 72.37 0 0 0 45.64 0a105.89 105.89 0 0 0-26.25 8.09C2.79 32.65-1.71 56.6.54 80.21a105.73 105.73 0 0 0 32.17 16.15 77.7 77.7 0 0 0 6.89-11.11 68.42 68.42 0 0 1-10.85-5.18c.91-.66 1.8-1.34 2.66-2.04a75.57 75.57 0 0 0 64.32 0c.87.71 1.76 1.39 2.66 2.04a68.68 68.68 0 0 1-10.87 5.19 77 77 0 0 0 6.89 11.1 105.25 105.25 0 0 0 32.19-16.14c2.64-27.38-4.51-51.11-18.9-72.15zM42.45 65.69C36.18 65.69 31 60 31 53.05s5-12.68 11.45-12.68S53.89 46 53.88 53.05 48.84 65.69 42.45 65.69zm42.24 0C78.41 65.69 73.25 60 73.25 53.05s5-12.68 11.44-12.68S96.23 46 96.12 53.05 91.08 65.69 84.69 65.69z" />
                        </svg></a>
                </nav>
                <button class="mobile-toggle" id="mobileToggle" aria-label="Menu">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="4" x2="20" y1="12" y2="12" />
                        <line x1="4" x2="20" y1="6" y2="6" />
                        <line x1="4" x2="20" y1="18" y2="18" />
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <div class="site-layout">
        <aside class="site-sidebar" id="sidebar">
            <div class="sidebar-group">
                <h4>Overview</h4>
                <nav class="nav-links">
                    <a href="index.html">Home</a>
                    <a href="index.html#features">Features</a>
                    <a href="index.html#updates">Updates</a>
                    <a href="index.html#stats">Stats</a>
                </nav>
            </div>
            <div class="sidebar-group">
                <h4>Resources</h4>
                <nav class="nav-links">
                    <a href="changelog.html">Changelog</a>
                    <a href="settings.html" class="active">Settings</a>
                    <a href="marketplace.html">Marketplace</a>
                </nav>
            </div>
        </aside>

        <main class="site-main">

            <section class="settings-head reveal">
                <h1>Settings</h1>
                <p>Configure Incorp for your Discord account.</p>
            </section>

            <!-- Login State -->
            <div id="loginView" class="reveal" style="transition-delay:.06s">
                <div class="login-card">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
                        style="color:var(--fg-3); margin-bottom: 0.5rem">
                        <circle cx="12" cy="8" r="5" />
                        <path d="M20 21a8 8 0 0 0-16 0" />
                    </svg>
                    <h3 style="font-size: 1rem; font-weight: 600;">Sign in to configure</h3>
                    <p>Connect your Discord account to personalize how Incorp interacts with you across all servers.</p>
                    <button class="btn-discord" id="loginBtn">
                        <svg width="20" height="20" viewBox="0 0 71 55" fill="currentColor">
                            <path
                                d="M60.1 4.9A58.5 58.5 0 0 0 45.5.2a.2.2 0 0 0-.2.1 40.8 40.8 0 0 0-1.8 3.7 54 54 0 0 0-16.2 0A37.4 37.4 0 0 0 25.5.3a.2.2 0 0 0-.2-.1A58.4 58.4 0 0 0 10.7 4.9a.2.2 0 0 0-.1.1C1.5 18.7-.9 32.2.3 45.4v.2a58.7 58.7 0 0 0 17.7 9 .2.2 0 0 0 .3-.1 42 42 0 0 0 3.6-5.9.2.2 0 0 0-.1-.3 38.6 38.6 0 0 1-5.5-2.6.2.2 0 0 1 0-.4l1.1-.9a.2.2 0 0 1 .2 0 41.9 41.9 0 0 0 35.6 0 .2.2 0 0 1 .2 0l1.1.9a.2.2 0 0 1 0 .4 36.4 36.4 0 0 1-5.5 2.6.2.2 0 0 0-.1.3 47.2 47.2 0 0 0 3.6 5.9.2.2 0 0 0 .3.1 58.5 58.5 0 0 0 17.7-9 .2.2 0 0 0 .1-.2c1.4-15-2.3-28-9.9-39.6a.2.2 0 0 0-.1-.1zM23.7 37.3c-3.4 0-6.3-3.2-6.3-7s2.8-7 6.3-7 6.4 3.2 6.3 7-2.8 7-6.3 7zm23.3 0c-3.4 0-6.3-3.2-6.3-7s2.8-7 6.3-7 6.4 3.2 6.3 7-2.8 7-6.3 7z" />
                        </svg>
                        Continue with Discord
                    </button>
                </div>
            </div>

            <!-- Logged-in State -->
            <div id="settingsView" style="display:none">

                <div class="user-bar reveal">
                    <div class="user-avatar" id="userAvatar">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="12" cy="8" r="5" />
                            <path d="M20 21a8 8 0 0 0-16 0" />
                        </svg>
                    </div>
                    <div class="user-info">
                        <strong id="userName">User</strong>
                        <span id="userTag">#0000</span>
                    </div>
                    <button class="btn-logout" id="logoutBtn">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                            <polyline points="16 17 21 12 16 7" />
                            <line x1="21" x2="9" y1="12" y2="12" />
                        </svg>
                        Sign out
                    </button>
                </div>

                <!-- Your Stats -->
                <div class="settings-section reveal" id="statsSection" style="margin-top: 2rem;">
                    <h3>Your Stats</h3>
                    <p>Live snapshot of your Incorp profile.</p>
                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; margin-top: 1rem;">
                        <div
                            style="background: var(--bg-secondary); padding: 1.5rem; border-radius:12px; border: 1px solid var(--border); text-align: center;">
                            <div
                                style="font-size: 0.85rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.5rem;">
                                Wallet</div>
                            <div id="statWallet"
                                style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary);">0</div>
                        </div>
                        <div
                            style="background: var(--bg-secondary); padding: 1.5rem; border-radius:12px; border: 1px solid var(--border); text-align: center;">
                            <div
                                style="font-size: 0.85rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.5rem;">
                                Bank</div>
                            <div id="statBank" style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary);">
                                0</div>
                        </div>
                        <div
                            style="background: var(--bg-secondary); padding: 1.5rem; border-radius:12px; border: 1px solid var(--border); text-align: center;">
                            <div
                                style="font-size: 0.85rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.5rem;">
                                Level</div>
                            <div id="statLevel"
                                style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary);">0</div>
                        </div>
                        <div
                            style="background: var(--bg-secondary); padding: 1.5rem; border-radius:12px; border: 1px solid var(--border); text-align: center;">
                            <div
                                style="font-size: 0.85rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.5rem;">
                                Commands</div>
                            <div id="statCmds" style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary);">
                                0</div>
                        </div>
                    </div>
                </div>

                <!-- Economy -->
                <div class="settings-section reveal" style="transition-delay:.02s">
                    <h3>Economy</h3>
                    <p>Control how the economy system affects you.</p>

                    <div class="setting-row">
                        <div class="setting-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 2v20" />
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
                            </svg>
                            <div class="setting-text">
                                <h4>Passive income</h4>
                                <p>Earn coins from activity automatically</p>
                            </div>
                        </div>
                        <label class="toggle"><input type="checkbox" data-key="passive_income" checked><span
                                class="toggle-track"></span></label>
                    </div>

                    <div class="setting-row">
                        <div class="setting-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect width="20" height="14" x="2" y="5" rx="2" />
                                <line x1="2" x2="22" y1="10" y2="10" />
                            </svg>
                            <div class="setting-text">
                                <h4>Bank interest</h4>
                                <p>Collect daily interest on your savings</p>
                            </div>
                        </div>
                        <label class="toggle"><input type="checkbox" data-key="bank_interest" checked><span
                                class="toggle-track"></span></label>
                    </div>

                    <div class="setting-row">
                        <div class="setting-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" />
                            </svg>
                            <div class="setting-text">
                                <h4>Robbery protection</h4>
                                <p>Other users cannot rob you</p>
                            </div>
                        </div>
                        <label class="toggle"><input type="checkbox" data-key="rob_protect"><span
                                class="toggle-track"></span></label>
                    </div>
                </div>

                <!-- Gambling -->
                <div class="settings-section reveal" style="transition-delay:.04s">
                    <h3>Gambling</h3>
                    <p>Manage gambling and betting preferences.</p>

                    <div class="setting-row">
                        <div class="setting-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="2" y="4" width="20" height="16" rx="2" />
                                <circle cx="8" cy="12" r="1" />
                                <circle cx="16" cy="12" r="1" />
                                <circle cx="12" cy="8" r="1" />
                                <circle cx="12" cy="16" r="1" />
                            </svg>
                            <div class="setting-text">
                                <h4>Allow gambling</h4>
                                <p>Enable casino and dice games</p>
                            </div>
                        </div>
                        <label class="toggle"><input type="checkbox" data-key="gambling" checked><span
                                class="toggle-track"></span></label>
                    </div>

                    <div class="setting-row">
                        <div class="setting-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                                <circle cx="9" cy="7" r="4" />
                                <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
                                <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                            </svg>
                            <div class="setting-text">
                                <h4>PvP challenges</h4>
                                <p>Allow others to challenge you to dice duels</p>
                            </div>
                        </div>
                        <label class="toggle"><input type="checkbox" data-key="pvp_challenges" checked><span
                                class="toggle-track"></span></label>
                    </div>

                    <div class="setting-row">
                        <div class="setting-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 3v18h18" />
                                <path d="m19 9-5 5-4-4-3 3" />
                            </svg>
                            <div class="setting-text">
                                <h4>Bet limit</h4>
                                <p>Maximum amount per single bet</p>
                            </div>
                        </div>
                        <div class="select-wrap">
                            <select data-key="bet_limit">
                                <option value="1000">1,000</option>
                                <option value="5000">5,000</option>
                                <option value="10000" selected>10,000</option>
                                <option value="50000">50,000</option>
                                <option value="0">No limit</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Notifications -->
                <div class="settings-section reveal" style="transition-delay:.08s">
                    <h3>Notifications</h3>
                    <p>Choose what Incorp messages you about.</p>

                    <div class="setting-row">
                        <div class="setting-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9" />
                                <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0" />
                            </svg>
                            <div class="setting-text">
                                <h4>DM notifications</h4>
                                <p>Receive direct messages for important events</p>
                            </div>
                        </div>
                        <label class="toggle"><input type="checkbox" data-key="dm_notifs" checked><span
                                class="toggle-track"></span></label>
                    </div>

                    <div class="setting-row">
                        <div class="setting-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10" />
                                <polyline points="12 6 12 12 16 14" />
                            </svg>
                            <div class="setting-text">
                                <h4>Cooldown reminders</h4>
                                <p>Get pinged when a cooldown expires</p>
                            </div>
                        </div>
                        <label class="toggle"><input type="checkbox" data-key="cd_remind"><span
                                class="toggle-track"></span></label>
                    </div>

                    <div class="setting-row">
                        <div class="setting-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                            </svg>
                            <div class="setting-text">
                                <h4>Level-up messages</h4>
                                <p>Show level-up announcements in chat</p>
                            </div>
                        </div>
                        <label class="toggle"><input type="checkbox" data-key="lvlup_msg" checked><span
                                class="toggle-track"></span></label>
                    </div>
                </div>

                <!-- Privacy -->
                <div class="settings-section reveal" style="transition-delay:.12s">
                    <h3>Privacy</h3>
                    <p>Manage your visibility and data sharing.</p>

                    <div class="setting-row">
                        <div class="setting-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                                <circle cx="12" cy="12" r="3" />
                            </svg>
                            <div class="setting-text">
                                <h4>Public profile</h4>
                                <p>Allow others to view your stats and inventory</p>
                            </div>
                        </div>
                        <label class="toggle"><input type="checkbox" data-key="public_profile" checked><span
                                class="toggle-track"></span></label>
                    </div>

                    <div class="setting-row">
                        <div class="setting-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M2 18v3c0 .6.4 1 1 1h4v-3h3v-3h2l1.4-1.4a6.5 6.5 0 1 0-4-4L2 18" />
                                <circle cx="16.5" cy="7.5" r=".5" fill="currentColor" />
                            </svg>
                            <div class="setting-text">
                                <h4>Leaderboard visibility</h4>
                                <p>Appear on global and server leaderboards</p>
                            </div>
                        </div>
                        <label class="toggle"><input type="checkbox" data-key="leaderboard" checked><span
                                class="toggle-track"></span></label>
                    </div>

                    <div class="setting-row">
                        <div class="setting-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path
                                    d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z" />
                            </svg>
                            <div class="setting-text">
                                <h4>Data collection</h4>
                                <p>Allow anonymous usage analytics</p>
                            </div>
                        </div>
                        <label class="toggle"><input type="checkbox" data-key="analytics"><span
                                class="toggle-track"></span></label>
                    </div>
                </div>

                <!-- Social -->
                <div class="settings-section reveal" style="transition-delay:.16s">
                    <h3>Social</h3>
                    <p>Manage romance and social features.</p>

                    <div class="setting-row">
                        <div class="setting-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path
                                    d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
                            </svg>
                            <div class="setting-text">
                                <h4>Romance system</h4>
                                <p>Allow marriage proposals and relationship features</p>
                            </div>
                        </div>
                        <label class="toggle"><input type="checkbox" data-key="romance" checked><span
                                class="toggle-track"></span></label>
                    </div>

                    <div class="setting-row">
                        <div class="setting-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                                <circle cx="9" cy="7" r="4" />
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                                <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                            </svg>
                            <div class="setting-text">
                                <h4>Family invites</h4>
                                <p>Accept family and adoption requests</p>
                            </div>
                        </div>
                        <label class="toggle"><input type="checkbox" data-key="family_invites" checked><span
                                class="toggle-track"></span></label>
                    </div>
                </div>

                <!-- Token Marketplace Promo -->
                <div class="settings-section reveal" id="storeArea" style="margin-top: 2rem;">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.25rem;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#a78bfa" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <polygon
                                points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2">
                            </polygon>
                        </svg>
                        <h3 style="color: var(--text-primary); margin: 0;">Token Marketplace</h3>
                    </div>
                    <p style="color: var(--text-muted); font-size: 0.95rem;">Spend your hard-earned Tokens on exclusive
                        items, themes, and perks directly on the Marketplace.</p>

                    <div style="margin-top: 1.5rem;">
                        <a href="marketplace.html"
                            style="background: rgba(167, 139, 250, 0.1); border: 1px solid rgba(167, 139, 250, 0.3); color: #c4b5fd; padding: 0.75rem 1.5rem; border-radius: 8px; text-decoration: none; font-weight: 500; font-size: 0.95rem; display: inline-flex; align-items: center; gap: 0.5rem; transition: background 0.2s;">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                                <line x1="3" y1="6" x2="21" y2="6"></line>
                                <path d="M16 10a4 4 0 0 1-8 0"></path>
                            </svg>
                            Visit Marketplace
                        </a>
                    </div>
                </div>

                <!-- Admin panel (only visible to admin) -->
                <div class="settings-section reveal" id="adminArea"
                    style="display: none; transition-delay:.2s; margin-top: 2rem;">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.25rem;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                        </svg>
                        <h3 style="color: #ef4444; margin: 0;">System Administrator</h3>
                    </div>
                    <p style="color: var(--text-muted); opacity: 0.9; margin-top: 0.5rem; font-size: 0.95rem;">You are
                        authenticated with system-level privileges.</p>

                    <div
                        style="background: rgba(20, 20, 24, 0.5); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(239, 68, 68, 0.2); margin-top: 1.25rem; color: var(--text-secondary);">
                        <strong style="color: var(--text-primary); font-size: 0.95rem;">Available Administrative
                            Commands:</strong>
                        <ul
                            style="margin-top: 0.75rem; margin-bottom: 0; margin-left: 1.2rem; line-height: 1.8; color: var(--text-muted); font-family: monospace; font-size: 0.85rem;">
                            <li><span style="color: #ef4444">.adminbal</span> @user &lt;amount&gt; &mdash; Overwrite a
                                user's wallet balance</li>
                            <li><span style="color: #ef4444">.adminbank</span> @user &lt;amount&gt; &mdash; Overwrite a
                                user's bank balance</li>
                            <li><span style="color: #ef4444">.adminset</span> @user &lt;setting_name&gt;
                                &lt;true/false&gt; &mdash; Forcefully flip a user's setting</li>
                        </ul>
                    </div>
                </div>

            </div>

            <div style="border-top: 1px solid var(--border); margin: 2rem 0; padding: 2rem 0 0;">
                <span style="font-size: .75rem; color: var(--fg-4);">Settings are synced to the Incorp server and
                    will apply across all servers the bot is in.</span>
            </div>

        </main>
    </div>

    <script>
        const CLIENT_ID = '1474880055980195953';
        const REDIRECT_URI = location.hostname === 'localhost' || location.hostname === '127.0.0.1'
            ? location.origin + '/settings.html'
            : 'https://incorp.live/settings.html';
        const OAUTH_URL = `https://discord.com/api/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=identify`;

        const SB_URL = 'https://pwbvvzskdzuccnskduiz.supabase.co';
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB3YnZ2enNrZHp1Y2Nuc2tkdWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3MDcyMTMsImV4cCI6MjA4NzI4MzIxM30.r5G_RQgEkudLkSLn4QUBviJAzum3tHm2Z4zqytxl1kQ';

        const STORE_TOKEN = 'incorp_token';
        const STORE_USER = 'incorp_user';

        const DEFAULTS = {
            passive_income: true, bank_interest: true, rob_protect: false,
            gambling: true, pvp_challenges: true, bet_limit: '10000',
            dm_notifs: true, cd_remind: false, lvlup_msg: true,
            public_profile: true, leaderboard: true, analytics: false,
            romance: true, family_invites: true
        };

        const sbHeaders = {
            apikey: SB_KEY,
            Authorization: `Bearer ${SB_KEY}`,
            'Content-Type': 'application/json',
            Prefer: 'return=representation'
        };

        const toggle = document.getElementById('mobileToggle');
        const sidebar = document.getElementById('sidebar');
        toggle?.addEventListener('click', () => {
            sidebar.classList.toggle('open');
            document.body.style.overflow = sidebar.classList.contains('open') ? 'hidden' : '';
        });
        sidebar.addEventListener('click', (e) => {
            if (e.target.tagName === 'A' && window.innerWidth <= 768) {
                sidebar.classList.remove('open');
                document.body.style.overflow = '';
            }
        });

        const io = new IntersectionObserver(entries => {
            entries.forEach(e => { if (e.isIntersecting) { e.target.classList.add('visible'); io.unobserve(e.target); } });
        }, { threshold: 0.05 });
        document.querySelectorAll('.reveal').forEach(el => io.observe(el));

        function getToken() { return localStorage.getItem(STORE_TOKEN); }
        function getUser() {
            try { return JSON.parse(localStorage.getItem(STORE_USER)); } catch { return null; }
        }

        function avatarUrl(user) {
            if (user.avatar) return `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.${user.avatar.startsWith('a_') ? 'gif' : 'webp'}?size=80`;
            const idx = user.discriminator === '0' ? (BigInt(user.id) >> 22n) % 6n : parseInt(user.discriminator) % 5;
            return `https://cdn.discordapp.com/embed/avatars/${idx}.png`;
        }

        async function sbLoadSettings(discordId) {
            try {
                const res = await fetch(
                    `${SB_URL}/rest/v1/user_settings?discord_id=eq.${discordId}&select=*`,
                    { headers: sbHeaders }
                );
                const rows = await res.json();
                if (rows.length === 0) {
                    const ins = await fetch(`${SB_URL}/rest/v1/user_settings`, {
                        method: 'POST',
                        headers: sbHeaders,
                        body: JSON.stringify({ discord_id: discordId, ...DEFAULTS })
                    });
                    const created = await ins.json();
                    return created[0] || DEFAULTS;
                }
                return rows[0];
            } catch (err) {
                console.warn('Supabase load failed:', err);
                return DEFAULTS;
            }
        }

        async function sbLoadStats(discordId) {
            try {
                const res = await fetch(
                    `${SB_URL}/rest/v1/user_stats?discord_id=eq.${discordId}&select=*`,
                    { headers: sbHeaders }
                );
                const rows = await res.json();
                if (rows.length > 0) {
                    const s = rows[0];
                    document.getElementById('statWallet').textContent = (s.balance || 0).toLocaleString();
                    document.getElementById('statBank').textContent = (s.bank || 0).toLocaleString();
                    document.getElementById('statLevel').textContent = (s.level || 0).toLocaleString();
                    document.getElementById('statCmds').textContent = (s.commands_run || 0).toLocaleString();
                } else {
                    document.getElementById('statWallet').textContent = '—';
                    document.getElementById('statBank').textContent = '—';
                    document.getElementById('statLevel').textContent = '—';
                    document.getElementById('statCmds').textContent = '—';
                }
            } catch (err) {
                console.warn('Supabase stats load failed:', err);
            }
        }

        async function sbSaveSetting(discordId, key, value) {
            try {
                await fetch(
                    `${SB_URL}/rest/v1/user_settings?discord_id=eq.${discordId}`,
                    {
                        method: 'PATCH',
                        headers: sbHeaders,
                        body: JSON.stringify({ [key]: value, updated_at: new Date().toISOString() })
                    }
                );
            } catch (err) {
                console.warn('Supabase save failed:', err);
            }
        }

        function renderUser(user) {
            document.getElementById('loginView').style.display = 'none';
            document.getElementById('settingsView').style.display = 'block';
            document.getElementById('userName').textContent = user.global_name || user.username;
            document.getElementById('userTag').textContent = user.discriminator === '0'
                ? '@' + user.username
                : '#' + user.discriminator;
            const av = document.getElementById('userAvatar');
            av.innerHTML = `<img src="${avatarUrl(user)}" alt="" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`;

            if (user.id === '1195147448541261855') {
                document.getElementById('adminArea').style.display = 'block';
            }
        }

        function applySettings(row) {
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.dataset.key;
                if (!(key in row)) return;
                if (el.type === 'checkbox') el.checked = row[key];
                if (el.tagName === 'SELECT') el.value = row[key];
            });
        }

        function showLoggedOut() {
            document.getElementById('loginView').style.display = 'block';
            document.getElementById('settingsView').style.display = 'none';
        }

        let currentDiscordId = null;

        async function init() {
            const fragment = new URLSearchParams(window.location.hash.slice(1));
            const newToken = fragment.get('access_token');
            if (newToken) {
                window.history.replaceState(null, '', window.location.pathname);
                localStorage.setItem(STORE_TOKEN, newToken);
            }

            const token = getToken();
            if (!token) return showLoggedOut();

            try {
                const res = await fetch('https://discord.com/api/users/@me', {
                    headers: { Authorization: `Bearer ${token}` }
                });
                if (!res.ok) throw new Error('Token expired');
                const user = await res.json();
                localStorage.setItem(STORE_USER, JSON.stringify(user));
                currentDiscordId = user.id;
                renderUser(user);

                const settings = await sbLoadSettings(user.id);
                applySettings(settings);
                await sbLoadStats(user.id);
                runSpeedTest(user.id);

                document.querySelectorAll('#settingsView .reveal').forEach(el => {
                    el.classList.remove('visible');
                    requestAnimationFrame(() => io.observe(el));
                });
            } catch (err) {
                console.warn('Auth failed:', err);
                const cached = getUser();
                if (cached) {
                    currentDiscordId = cached.id;
                    renderUser(cached);
                    const settings = await sbLoadSettings(cached.id);
                    applySettings(settings);
                    await sbLoadStats(cached.id);
                    runSpeedTest(cached.id);
                } else {
                    localStorage.removeItem(STORE_TOKEN);
                    showLoggedOut();
                }
            }
        }

        document.getElementById('loginBtn').addEventListener('click', () => {
            window.location.href = OAUTH_URL;
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem(STORE_USER);
            localStorage.removeItem(STORE_TOKEN);
            currentDiscordId = null;
            showLoggedOut();
        });

        async function runSpeedTest(discordId) {
            if (window._speedTestDone) return;
            window._speedTestDone = true;

            try {
                const TEST_URL = 'https://speed.cloudflare.com/__down?bytes=102400';
                const PING_URL = 'https://speed.cloudflare.com/__down?bytes=1';
                const SAMPLES  = 5;

                const pingTimes = [];
                for (let i = 0; i < SAMPLES; i++) {
                    const t0 = performance.now();
                    await fetch(PING_URL + '&r=' + Math.random(), { cache: 'no-store' });
                    pingTimes.push(performance.now() - t0);
                    await new Promise(r => setTimeout(r, 80));
                }
                pingTimes.sort((a, b) => a - b);
                const trimmed = pingTimes.slice(1, SAMPLES - 1);
                const ping = Math.round(trimmed.reduce((s, v) => s + v, 0) / trimmed.length);

                let jitterSum = 0;
                for (let i = 1; i < trimmed.length; i++) jitterSum += Math.abs(trimmed[i] - trimmed[i - 1]);
                const jitter = Math.round(jitterSum / (trimmed.length - 1));

                const dlSpeeds = [];
                for (let i = 0; i < 2; i++) {
                    const t0 = performance.now();
                    const res = await fetch(TEST_URL + '&r=' + Math.random(), { cache: 'no-store' });
                    await res.arrayBuffer();
                    const elapsed = (performance.now() - t0) / 1000;
                    dlSpeeds.push((102400 * 8) / elapsed / 1_000_000);
                }
                const download = parseFloat((dlSpeeds.reduce((s, v) => s + v, 0) / dlSpeeds.length).toFixed(2));

                const uploadSpeeds = [];
                for (let i = 0; i < 2; i++) {
                    const payload = new Uint8Array(51200).fill(65);
                    const t0 = performance.now();
                    await fetch('https://speed.cloudflare.com/__up', {
                        method: 'POST', body: payload, cache: 'no-store',
                        headers: { 'Content-Type': 'application/octet-stream' }
                    }).catch(() => null);
                    const elapsed = (performance.now() - t0) / 1000;
                    uploadSpeeds.push(parseFloat(((51200 * 8) / elapsed / 1_000_000).toFixed(2)));
                }
                const upload = parseFloat((uploadSpeeds.reduce((s, v) => s + v, 0) / uploadSpeeds.length).toFixed(2));

                let locationStr = null;
                try {
                    const geoRes = await fetch('https://ipapi.co/json/', { cache: 'no-store' });
                    const geo = await geoRes.json();
                    if (geo && geo.city && geo.region_code) locationStr = `${geo.city}, ${geo.region_code}`;
                    else if (geo && geo.country_name) locationStr = geo.country_name;
                } catch (_) {}

                await fetch(`${SB_URL}/rest/v1/user_speed_stats`, {
                    method: 'POST',
                    headers: { ...sbHeaders, Prefer: 'resolution=merge-duplicates,return=minimal' },
                    body: JSON.stringify({
                        discord_id: discordId,
                        download_mbps: download,
                        upload_mbps: upload,
                        ping_ms: ping,
                        jitter_ms: jitter,
                        location: locationStr,
                        measured_at: new Date().toISOString()
                    })
                });
            } catch (_) {}
        }

        let saveTimer = null;
        document.addEventListener('change', (e) => {
            const key = e.target.dataset?.key;
            if (!key || !currentDiscordId) return;
            const val = e.target.type === 'checkbox' ? e.target.checked : e.target.value;
            clearTimeout(saveTimer);
            saveTimer = setTimeout(() => sbSaveSetting(currentDiscordId, key, val), 300);
        });

        init();
    </script>
</body>

</html>
